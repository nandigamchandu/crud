"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("devfractal-api"),r=require("devfractal-router"),n=require("devfractal-ui-api"),i=require("query-string"),a=e(require("react")),o=require("technoidentity-utils"),c=require("devfractal-ui-core"),u=require("react-router-dom"),s=require("@fortawesome/free-solid-svg-icons"),l=require("devfractal-simple"),m=require("devfractal-ui"),d=e(require("axios")),p=require("devfractal-forms"),f=require("date-fns"),v=require("react-router");function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function E(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(i[r]=e[r]);return i}var g=o.opt({page:o.IntFromString,limit:o.IntFromString,asc:o.string,desc:o.string});function b(e){var t=o.cast(g,o.cast(o.record(o.string,o.string),i.parse(e))),r=t.page,n=t.limit,a=t.asc,c=t.desc;return{range:{current:void 0===r?1:r,limit:void 0===n?25:n},asc:a?[a]:[],desc:c?[c]:[]}}function y(e){var o=e.api,c=e.list,u=e.queryFn,s=void 0===u?b:u,l=r.useLocation(),m=l.pathname,d=l.search,p=r.useHistory().push,f=s(d);function v(e){p(m+"?"+i.stringify(h({},f,{page:e})))}var E=t.Page.is(f.range)&&f.range.current?f.range.current:1;return a.createElement(n.Get,{asyncFn:function(e){try{return Promise.resolve(e?o.list(e):o.many())}catch(e){return Promise.reject(e)}},deps:[f]},function(e){return a.createElement(c,{data:e,page:E,onPageChange:v})})}function P(e){var t=e.path,n=E(e,["path"]);return t?a.createElement(r.Route,{path:t,render:function(){return a.createElement(y,Object.assign({},n))}}):a.createElement(y,Object.assign({},n))}var x=function(e){var t,r=e.variant,n=e.size,i=e.state,o=e.fullWidth,s=e.rounded,l=e.inverted,m=e.outlined,d=e.children,p=E(e,["variant","size","state","fullWidth","rounded","inverted","outlined","children"]),f=c.classNamesHelper(p,"button",((t={})["is-"+r]=r,t["is-"+n]=n,t["is-"+i]=i,t["is-rounded"]=s,t["is-inverted"]=l,t["is-outlined"]=m,t["is-fullwidth"]=o,t)),v=E(c.removeIconHelpers(c.removeControlHelpers(c.removeHelpers(p))),["inputMode"]);return a.createElement(u.Link,Object.assign({},v,{className:f}),d)};function j(e,t){return t?t+"/"+e:"/"+e}function C(e,t){return{list:""+j(e,t),view:j(e,t)+"/:id",edit:j(e,t)+"/:id/edit",create:j(e,t)+"/new"}}function S(e,t){return h({},C(e),{view:function(r){return j(e,t)+"/"+r},edit:function(r){return j(e,t)+"/"+r+"/edit"}})}function w(e){return o.obj({initial:e},{onSubmit:o.fn()})}function k(e){return o.req({page:o.number,onPageChange:o.fn(),data:o.readonlyArray(e)})}function O(e){return a.createElement(n.Post,{component:e.form,onPost:e.api.create,redirectTo:e.redirectTo})}function q(e){var t=e.path,n=E(e,["path"]);return t?a.createElement(r.Route,{path:t,render:function(){return a.createElement(O,Object.assign({},n))}}):a.createElement(O,Object.assign({},n))}function T(e){var t,i=e.api,c=e.redirectTo,u=e.form;if(void 0===o.getProp(i.spec,i.idKey))throw new Error(i.idKey+" not defined");var s=r.useMatch(o.type(((t={})[i.idKey]=o.string,t)));return a.createElement(n.Put,{id:s.params[i.idKey],doGet:i.get,onPut:i.replace,component:u,redirectTo:c})}function R(e){var t=e.path,n=E(e,["path"]);return t?a.createElement(r.Route,{path:t,render:function(){return a.createElement(T,Object.assign({},n))}}):a.createElement(T,Object.assign({},n))}var F=function(e){var t=e.onDelete;return a.createElement(a.Fragment,null,a.createElement(u.Link,{to:e.editTo},a.createElement(c.Icon,{icon:s.faEdit})),t&&a.createElement("a",{href:"#!",onClick:function(e){e.preventDefault(),t()}},a.createElement(c.Icon,{icon:s.faTrash})))};function L(e){var t=e.api,r=e.id,i=e.view;return a.createElement(n.Get,{asyncFn:function(){return t.get(r)}},function(e){return a.createElement(i,{data:e})})}var V=function(e){var t=e.page,r=e.maxPages,n=e.onPageChange;return a.createElement(m.Pagination,{alignment:"centered"},a.createElement(m.PaginationPrevious,{invisible:t<=1,onClick:function(){n(t-1)}},"Previous"),a.createElement(m.PaginationNext,{invisible:void 0!==r&&t>=r,onClick:function(){n(t+1)}},"Next"))},I=o.union([o.Int,o.string]),A=function(e,t){try{var r=e.decode;return Promise.resolve(t).then(function(t){return o.toPromise(r.call(e,t.data))})}catch(e){return Promise.reject(e)}};function G(e){var t=e.baseURL,r=e.value,n=e.id,i=e.resource,a=e.listValue,c=void 0===a?o.readonlyArray(r):a,u=e.urls,s=void 0===u?function(e){var t=e.resource,r=o.chop(e.baseURL.trim()),n=t.trim();return o.verify(r.startsWith("http")),o.verify(!n.includes("/")),{all:function(){return r+"/"+n},create:function(){return r+"/"+n},one:function(e){return o.cast(I,e),r+"/"+n+"/"+e},edit:function(e){return o.cast(I,e),r+"/"+n+"/"+e},remove:function(e){return o.cast(I,e),r+"/"+n+"/"+e}}}({baseURL:t,resource:i}):u;return{baseURL:t,resource:i,value:r,listValue:c,urls:s,id:n,all:function(){try{return Promise.resolve(A(c,d.get(s.all()))).then(function(e){return o.cast(c,e),e})}catch(e){return Promise.reject(e)}},remove:function(e){try{return Promise.resolve(A(r,d.delete(s.remove(e)))).then(function(e){return o.cast(r,e),e})}catch(e){return Promise.reject(e)}},create:function(e){try{return Promise.resolve(A(r,d.post(s.create(),e))).then(function(e){return o.cast(r,e),e})}catch(e){return Promise.reject(e)}},edit:function(e){try{return o.cast(r,e),Promise.resolve(A(r,d.put(s.edit(e.id),e))).then(function(e){return o.cast(r,e),e})}catch(e){return Promise.reject(e)}},one:function(e){try{return Promise.resolve(A(r,d.get(s.one(e)))).then(function(e){return o.cast(r,e),e})}catch(e){return Promise.reject(e)}}}}function H(e){return"function"==typeof e}function K(e){var t=e.data,r=e.id;return a.createElement(c.Section,null,a.createElement(l.Simple.Form,{validationSchema:e.schema,initialValues:t,onSubmit:e.onSubmit},Object.keys(t).map(function(e){return a.createElement(a.Fragment,{key:e},e!==r&&(o.boolean.is(t[e])?a.createElement(l.Simple.Checkbox,{name:e}):o.number.is(t[e])?a.createElement(l.Simple.Number,{name:e}):o.date.is(t[e])?a.createElement(l.Simple.Date,{name:e}):a.createElement(l.Simple.Text,{name:e})))}),a.createElement(l.Simple.FormButtons,null)))}function N(e){var t=e.data,r=e.onSubmit,i=e.id;return H(t)?a.createElement(n.Get,{asyncFn:t},function(e){return a.createElement(K,{id:i,data:e,onSubmit:r})}):a.createElement(K,{id:i,data:t,onSubmit:r})}var B=function(e){return a.createElement(c.Title,{size:"6"},o.camelCaseToPhrase(e.objectKey))},D=function(e){var t,r=e.objectValue;return o.boolean.is(r)?a.createElement(c.CheckBox,{checked:r,readOnly:!0}):o.date.is(r)?a.createElement(c.Text,null,(t=r)&&f.format(t,"dd/MM/yyyy")):a.createElement(a.Fragment,null,r)};function M(e){var t=e.data;return a.createElement(c.Section,null,Object.keys(t).map(function(e){return a.createElement(c.Columns,{key:e},a.createElement(c.Column,null,a.createElement(B,{objectKey:e})),a.createElement(c.Column,null,a.createElement(D,{objectValue:t[e]})))}))}function U(e){var t=e.data;return H(t)?a.createElement(n.Get,{asyncFn:t},function(e){return a.createElement(M,{data:e})}):a.createElement(M,{data:t})}function z(e,t){return{Create:function(r){var n=r.onSubmit;return a.createElement(N,{id:t,data:o.empty(e),onSubmit:n})},Edit:function(e){return a.createElement(N,{id:t,data:e.data,onSubmit:e.onSubmit})},View:function(e){return a.createElement(U,{data:e.data})},List:function(e){var t=e.list,r=e.onEdit;return a.createElement(c.Container,null,a.createElement(c.Field,{groupModifier:"grouped-right"},a.createElement(c.Button,{variant:"primary",onClick:e.onCreate},"New")),a.createElement(l.SimpleTable,{data:t,onRowClicked:r}))}}}function W(e){var t=e.api,r=t.all,n=t.one,i=t.create,o=t.edit,c="value"in e?e.resource:e.api.resource,u=e.Views||z("value"in e?e.value:e.api.value,"value"in e?e.id:e.api.id),s=e.basePath,l=S(c,s),m=C(c,s);return{List:function(e){var t=e.history;return a.createElement(u.List,{list:r,onEdit:function(e){return t.push(l.edit(e.value.id))},onCreate:function(){return t.push(m.create)}})},Create:function(e){var t=e.history;return a.createElement(u.Create,{onSubmit:function(e,r){try{return Promise.resolve(p.formikSubmit(i)(e,r)).then(function(){t.push(m.list)})}catch(e){return Promise.reject(e)}}})},Edit:function(e){var t=e.history,r=e.match;return a.createElement(u.Edit,{data:function(){try{return Promise.resolve(n(r.params.id))}catch(e){return Promise.reject(e)}},onSubmit:function(e,r){try{return Promise.resolve(p.formikSubmit(o)(e,r)).then(function(){t.push(m.list)})}catch(e){return Promise.reject(e)}}})},View:function(e){var t=e.match;return a.createElement(u.View,{data:function(){try{return Promise.resolve(n(t.params.id))}catch(e){return Promise.reject(e)}}})}}}function Q(e){var t=e.basePath,n=e.api,i=e.paths,o=void 0===i?C(n.resource,t):i,u=e.components,s=void 0===u?W({api:n,basePath:t}):u,l=o.list,m=o.edit,d=o.view,p=s.List,f=s.Edit,h=s.View;return a.createElement(c.Section,null,a.createElement(v.Switch,null,a.createElement(r.Route,{path:o.create,component:s.Create}),a.createElement(r.Route,{path:m,component:f}),a.createElement(r.Route,{path:d,component:h}),a.createElement(r.Route,{path:l,component:p})))}exports.Actions=F,exports.All=P,exports.ButtonLink=x,exports.ClientQuery=g,exports.Create=q,exports.CreateLink=function(e){var t=e.alignment,r=E(e,["alignment"]);return a.createElement(c.ButtonsGroup,{alignment:t},a.createElement(x,Object.assign({},r)))},exports.Crud=Q,exports.CrudRoutes=function(e){var t=e.api,r=e.list,n=e.form,i=e.paths,o=void 0===i?C(t.resource):i,c=e.redirectTo,u=void 0===c?o.list:c,s=o.create,l=o.list;return a.createElement(a.Fragment,null,a.createElement(R,{path:o.edit,api:t,form:n,redirectTo:u}),a.createElement(P,{api:t,list:r,path:l}),a.createElement(q,{path:s,redirectTo:u,api:t,form:n}))},exports.CrudTable=function(e){var t=e.editTo,r=e.onDelete,n=e.onRowClicked;return a.createElement(l.SimpleTable,{data:e.data,select:e.select,override:e.override,extra:[].concat(e.extra||[],["Actions"]),striped:!0,onRowClicked:n},function(e,n){return"Actions"===e?a.createElement(F,{editTo:t(n),onDelete:function(){r&&r(n)}}):null})},exports.Edit=R,exports.Editor=N,exports.EditorView=K,exports.One=function(e){var t=e.path,n=E(e,["path"]);return t?a.createElement(r.Route,{path:t,render:function(){return a.createElement(L,Object.assign({},n))}}):a.createElement(L,Object.assign({},n))},exports.Pager=V,exports.RoutedPager=function(){var e=r.useLocation().pathname,t=r.useHistory().push,n=function(e){var t=r.useLocation().search,n=o.cast(o.record(o.string,o.string),i.parse(t));return o.cast(e,n)}(o.opt({page:o.IntFromString}));return a.createElement(V,{page:n.page?n.page:1,onPageChange:function(r){t(e+"?"+i.stringify(h({},n,{page:r})))}})},exports.SimpleCrud=function(e){var t=e.basePath,r=void 0===t?"":t,n=e.id,i=e.resource,c=E(e,["basePath","id","resource"]);return o.assert(void 0!==n||"id"in c.value,"no id defined"),a.createElement(Q,{api:G(h({id:n,resource:i||c.value.name},c)),basePath:r})},exports.Viewer=U,exports.ViewerView=M,exports.Views=z,exports.api=G,exports.base=j,exports.components=W,exports.formComponent=function(e,t){return function(r){var n=r.initial,i=E(r,["initial"]),c=t,u=o.cast(w(e),i),s=h({initial:n||o.empty(e),edit:void 0!==n},u);return a.createElement(c,Object.assign({},s))}},exports.formProps=w,exports.links=S,exports.listComponent=function(e,t){return function(r){return a.createElement(t,Object.assign({},o.cast(k(e),r)))}},exports.listProps=k,exports.paths=C;
//# sourceMappingURL=devfractal-crud.cjs.production.min.js.map
